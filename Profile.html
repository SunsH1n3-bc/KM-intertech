<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan Check-in | ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, update, child } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCOu2MSd4fXzJppzoRn_3ZrCRiKoBVK11M",
            authDomain: "km-intertech.firebaseapp.com",
            databaseURL: "https://km-intertech-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "km-intertech",
            storageBucket: "km-intertech.firebasestorage.app",
            messagingSenderId: "378139509245",
            appId: "1:378139509245:web:c9a7d7bf3b92945be09994",
            measurementId: "G-23PJCBSTNF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        window.firebaseApp = app;
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseUpdate = update;
        window.firebaseChild = child;
        window.createUser = createUserWithEmailAndPassword;
        window.signInUser = signInWithEmailAndPassword;
        window.resetPassword = sendPasswordResetEmail;
        window.authStateChanged = onAuthStateChanged;
    </script>
    
    <style>
@import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');

:root {
    --primary-blue: #2563eb;
    --primary-blue-dark: #1d4ed8;
    --primary-blue-light: #3b82f6;
    --secondary-blue: #60a5fa;
    --accent-blue: #93c5fd;
    --light-blue: #dbeafe;
    --extra-light-blue: #f0f9ff;
    --white: #ffffff;
    --off-white: #fafafa;
    --light-gray: #f5f7fa;
    --gray: #6b7280;
    --dark-gray: #374151;
    --text-dark: #1f2937;
    
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-blue: 0 10px 15px -3px rgba(37, 99, 235, 0.1), 0 4px 6px -2px rgba(37, 99, 235, 0.05);
    
    --border-radius: 12px;
    --border-radius-sm: 8px;
    --border-radius-lg: 16px;
    
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Kanit', sans-serif;
    line-height: 1.6;
    color: var(--text-dark);
    background: linear-gradient(135deg, var(--extra-light-blue) 0%, var(--white) 100%);
    min-height: 100vh;
    overflow-x: hidden;
}

.background-pattern {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
}

.pattern-grid {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        radial-gradient(circle at 25% 25%, var(--light-blue) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, var(--accent-blue) 0%, transparent 50%);
    background-size: 100px 100px;
    opacity: 0.1;
    animation: patternMove 20s linear infinite;
}

@keyframes patternMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(100px, 100px); }
}

.floating-elements {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.floating-element {
    position: absolute;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue));
    opacity: 0.05;
    animation: float 15s ease-in-out infinite;
}

.floating-element.element-1 {
    width: 80px;
    height: 80px;
    top: 20%;
    left: 10%;
    animation-delay: 0s;
}

.floating-element.element-2 {
    width: 120px;
    height: 120px;
    top: 60%;
    right: 15%;
    animation-delay: -5s;
}

.floating-element.element-3 {
    width: 60px;
    height: 60px;
    bottom: 30%;
    left: 20%;
    animation-delay: -10s;
}

@keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-20px) rotate(90deg); }
    50% { transform: translateY(-40px) rotate(180deg); }
    75% { transform: translateY(-20px) rotate(270deg); }
}

.navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--light-blue);
    z-index: 1000;
    padding: 1rem 0;
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 2rem;
}

.nav-brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.nav-logo {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
    border-radius: var(--border-radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--white);
    font-size: 1.5rem;
    box-shadow: var(--shadow-blue);
}

.nav-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-blue);
}

.nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--gray);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius-sm);
}

.nav-link:hover {
    color: var(--primary-blue);
    background: var(--light-blue);
}

.main-container {
    display: flex;
    min-height: 100vh;
    padding-top: 80px;
}

.info-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background: linear-gradient(135deg, var(--white) 0%, var(--extra-light-blue) 100%);
}

.info-content {
    max-width: 500px;
    width: 100%;
}

.info-header {
    text-align: center;
    margin-bottom: 3rem;
}

.info-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
    font-size: 2.5rem;
    color: var(--white);
    box-shadow: var(--shadow-blue);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.info-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-blue);
    margin-bottom: 1rem;
}

.info-subtitle {
    font-size: 1.1rem;
    color: var(--gray);
    margin-bottom: 2rem;
}

.features-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.feature-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--white);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-md);
    transition: var(--transition);
}

.feature-item:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.feature-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--light-blue), var(--accent-blue));
    border-radius: var(--border-radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-blue);
    font-size: 1.5rem;
    flex-shrink: 0;
}

.feature-content h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary-blue);
    margin-bottom: 0.5rem;
}

.feature-content p {
    color: var(--gray);
    line-height: 1.6;
}

.login-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background: var(--white);
}

.login-container {
    max-width: 400px;
    width: 100%;
    background: var(--white);
    padding: 2.5rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--light-blue);
}

.login-header {
    text-align: center;
    margin-bottom: 2rem;
}

.login-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    font-size: 2rem;
    color: var(--white);
    box-shadow: var(--shadow-blue);
}

.login-title {
    font-size: 2rem;
    font-weight: 600;
    color: var(--primary-blue);
    margin-bottom: 0.5rem;
}

.login-subtitle {
    color: var(--gray);
    font-size: 1rem;
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-label {
    font-weight: 500;
    color: var(--text-dark);
    font-size: 0.9rem;
}

.input-container {
    position: relative;
    display: flex;
    align-items: center;
}

.input-icon {
    position: absolute;
    left: 1rem;
    color: var(--gray);
    font-size: 1.25rem;
    z-index: 1;
    transition: var(--transition);
}

.form-input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    border: 2px solid var(--light-blue);
    border-radius: var(--border-radius);
    font-size: 1rem;
    font-family: inherit;
    transition: var(--transition);
    background: var(--white);
}

.input-container.has-toggle .form-input {
    padding-right: 3rem;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-input:focus + .input-icon {
    color: var(--primary-blue);
}

.password-toggle {
    position: absolute;
    right: 1rem;
    background: none;
    border: none;
    color: var(--gray);
    cursor: pointer;
    font-size: 1.25rem;
    padding: 0.25rem;
    transition: var(--transition);
    z-index: 2;
}

.password-toggle:hover {
    color: var(--primary-blue);
}

.form-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 0.5rem 0;
}

.checkbox-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9rem;
}

.checkbox-container input[type="checkbox"] {
    display: none;
}

.checkmark {
    width: 18px;
    height: 18px;
    border: 2px solid var(--light-blue);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.checkbox-container input[type="checkbox"]:checked + .checkmark {
    background: var(--primary-blue);
    border-color: var(--primary-blue);
}

.checkbox-container input[type="checkbox"]:checked + .checkmark::after {
    content: '‚úì';
    color: var(--white);
    font-size: 12px;
    font-weight: bold;
}

.checkbox-text {
    color: var(--gray);
}

.forgot-link {
    color: var(--primary-blue);
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    transition: var(--transition);
}

.forgot-link:hover {
    color: var(--primary-blue-dark);
}

.login-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
    color: var(--white);
    border: none;
    border-radius: var(--border-radius);
    padding: 1rem 2rem;
    font-size: 1rem;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--shadow-blue);
}

.login-btn:hover {
    background: linear-gradient(135deg, var(--primary-blue-dark), var(--primary-blue));
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.login-btn:active {
    transform: translateY(0);
}

.login-btn:disabled {
    background: var(--gray);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.divider {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 1.5rem 0;
}

.divider::before,
.divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--light-blue);
}

.divider-text {
    color: var(--gray);
    font-size: 0.9rem;
    white-space: nowrap;
}

.login-footer {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--light-blue);
    text-align: center;
}

.footer-text {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    color: var(--gray);
    font-size: 0.85rem;
}

.footer-text a {
    color: var(--primary-blue);
    text-decoration: none;
    font-weight: 600;
}

.footer-text a:hover {
    text-decoration: underline;
}

.form-hint {
    font-size: 0.8rem;
    margin-top: 0.25rem;
    padding-left: 0.5rem;
    transition: var(--transition);
    min-height: 1rem;
}

.form-hint.success {
    color: #10b981;
}

.form-hint.error {
    color: #ef4444;
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition);
}

.loading-overlay.active {
    opacity: 1;
    visibility: visible;
}

.loading-content {
    text-align: center;
    background: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--light-blue);
}

.loading-spinner {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    animation: spin 1s linear infinite;
}

.loading-spinner ion-icon {
    font-size: 2rem;
    color: var(--white);
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-content h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-blue);
    margin-bottom: 0.5rem;
}

.loading-content p {
    color: var(--gray);
}

.success-modal,
.error-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition);
}

.success-modal.active,
.error-modal.active {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background: var(--white);
    padding: 2.5rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-xl);
    text-align: center;
    max-width: 400px;
    width: 90%;
    border: 1px solid var(--light-blue);
}

.success-icon,
.error-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
    font-size: 3rem;
}

.success-icon {
    background: linear-gradient(135deg, #10b981, #34d399);
    color: var(--white);
}

.error-icon {
    background: linear-gradient(135deg, #ef4444, #f87171);
    color: var(--white);
}

.modal-content h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.success-modal h3 {
    color: #10b981;
}

.error-modal h3 {
    color: #ef4444;
}

.modal-content p {
    color: var(--gray);
    margin-bottom: 2rem;
}

.modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
}

.modal-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: var(--border-radius);
    font-size: 0.9rem;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: var(--transition);
    border: none;
}

.modal-btn.primary {
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-light));
    color: var(--white);
    box-shadow: var(--shadow-blue);
}

.modal-btn.primary:hover {
    background: linear-gradient(135deg, var(--primary-blue-dark), var(--primary-blue));
    transform: translateY(-2px);
}

.modal-btn.secondary {
    background: var(--white);
    color: var(--primary-blue);
    border: 2px solid var(--primary-blue);
}

.modal-btn.secondary:hover {
    background: var(--primary-blue);
    color: var(--white);
}

.name-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

select.form-input {
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 1rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 3rem;
    cursor: pointer;
}

@media (max-width: 768px) {
    .main-container {
        flex-direction: column;
        padding-top: 70px;
    }
    
    .info-section {
        padding: 1.5rem;
    }
    
    .info-title {
        font-size: 2rem;
    }
    
    .login-section {
        padding: 1.5rem;
    }
    
    .login-container {
        padding: 2rem;
        max-height: calc(100vh - 140px);
        overflow-y: auto;
    }
    
    .name-grid {
        grid-template-columns: 1fr;
    }
}
    </style>
</head>
<body>
    <div class="background-pattern">
        <div class="pattern-grid"></div>
        <div class="floating-elements">
            <div class="floating-element element-1"></div>
            <div class="floating-element element-2"></div>
            <div class="floating-element element-3"></div>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="nav-logo">
                    <ion-icon name="scan-outline"></ion-icon>
                </div>
                <span class="nav-title">Scan Check-in</span>
            </div>
            <a href="#" class="nav-link">
                <ion-icon name="help-circle-outline"></ion-icon>
                <span>‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
            </a>
        </div>
    </nav>

    <main class="main-container">
        <div class="info-section">
            <div class="info-content">
                <div class="info-header">
                    <div class="info-icon">
                        <ion-icon name="scan-circle-outline"></ion-icon>
                    </div>
                    <h1 class="info-title">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h1>
                    <p class="info-subtitle">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                </div>
                
                <div class="features-list">
                    <div class="feature-item">
                        <div class="feature-icon">
                            <ion-icon name="flash-outline"></ion-icon>
                        </div>
                        <div class="feature-content">
                            <h3>‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</h3>
                            <p>‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">
                            <ion-icon name="shield-checkmark-outline"></ion-icon>
                        </div>
                        <div class="feature-content">
                            <h3>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á</h3>
                            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">
                            <ion-icon name="analytics-outline"></ion-icon>
                        </div>
                        <div class="feature-content">
                            <h3>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h3>
                            <p>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="login-section">
            <!-- Login Form -->
            <div class="login-container" id="loginContainer">
                <div class="login-header">
                    <div class="login-icon">
                        <ion-icon name="person-circle-outline"></ion-icon>
                    </div>
                    <h2 class="login-title">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                    <p class="login-subtitle">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                </div>

                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail" class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <div class="input-container">
                            <ion-icon name="mail-outline" class="input-icon"></ion-icon>
                            <input type="email" id="loginEmail" class="form-input" 
                                placeholder="example@school.ac.th" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="loginPassword" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <div class="input-container has-toggle">
                            <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                            <input type="password" id="loginPassword" class="form-input" 
                                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                                <ion-icon name="eye-outline"></ion-icon>
                            </button>
                        </div>
                    </div>

                    <div class="form-options">
                        <label class="checkbox-container">
                            <input type="checkbox" id="remember">
                            <span class="checkmark"></span>
                            <span class="checkbox-text">‡∏à‡∏î‡∏à‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                        </label>
                        <a href="#" class="forgot-link" onclick="showForgotForm(event)">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
                    </div>

                    <button type="submit" class="login-btn">
                        <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                        <ion-icon name="arrow-forward-outline"></ion-icon>
                    </button>
                </form>

                <div class="login-footer">
                    <p class="footer-text">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? 
                        <a href="#" onclick="showRegisterForm(event)">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
                    </p>
                </div>
            </div>

            <!-- Register Form -->
            <div class="login-container" id="registerContainer" style="display: none;">
                <div class="login-header">
                    <div class="login-icon">
                        <ion-icon name="person-add-outline"></ion-icon>
                    </div>
                    <h2 class="login-title">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
                    <p class="login-subtitle">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</p>
                </div>

                <form class="login-form" id="registerForm">
                    <div class="form-group">
                        <label for="role" class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                        <div class="input-container">
                            <ion-icon name="accessibility-outline" class="input-icon"></ion-icon>
                            <select id="role" class="form-input" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                                <option value="student">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                                <option value="teacher">‡∏Ñ‡∏£‡∏π</option>
                            </select>
                        </div>
                    </div>

                    <div class="name-grid">
                        <div class="form-group">
                            <label for="firstName" class="form-label">‡∏ä‡∏∑‡πà‡∏≠</label>
                            <div class="input-container">
                                <ion-icon name="person-outline" class="input-icon"></ion-icon>
                                <input type="text" id="firstName" class="form-input" 
                                    placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="lastName" class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <div class="input-container">
                                <ion-icon name="person-outline" class="input-icon"></ion-icon>
                                <input type="text" id="lastName" class="form-input" 
                                    placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="regEmail" class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <div class="input-container">
                            <ion-icon name="mail-outline" class="input-icon"></ion-icon>
                            <input type="email" id="regEmail" class="form-input" 
                                placeholder="example@school.ac.th" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="phone" class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <div class="input-container">
                            <ion-icon name="call-outline" class="input-icon"></ion-icon>
                            <input type="tel" id="phone" class="form-input" 
                                placeholder="0812345678" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="studentId" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
                        <div class="input-container">
                            <ion-icon name="card-outline" class="input-icon"></ion-icon>
                            <input type="text" id="studentId" class="form-input" 
                                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏Ñ‡∏£‡∏π" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="classField" class="form-label">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡πÅ‡∏ú‡∏ô‡∏Å</label>
                        <div class="input-container">
                            <ion-icon name="school-outline" class="input-icon"></ion-icon>
                            <input type="text" id="classField" class="form-input" 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô 3/1 ‡∏´‡∏£‡∏∑‡∏≠ ‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="regPassword" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <div class="input-container has-toggle">
                            <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                            <input type="password" id="regPassword" class="form-input" 
                                placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('regPassword')">
                                <ion-icon name="eye-outline"></ion-icon>
                            </button>
                        </div>
                        <div class="form-hint" id="passwordHint"></div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <div class="input-container has-toggle">
                            <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                            <input type="password" id="confirmPassword" class="form-input" 
                                placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" required>
                            <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
                                <ion-icon name="eye-outline"></ion-icon>
                            </button>
                        </div>
                        <div class="form-hint" id="confirmHint"></div>
                    </div>

                    <div class="form-options">
                        <label class="checkbox-container">
                            <input type="checkbox" id="acceptTerms" required>
                            <span class="checkmark"></span>
                            <span class="checkbox-text">‡∏â‡∏±‡∏ô‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                        </label>
                    </div>

                    <button type="submit" class="login-btn">
                        <span>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
                        <ion-icon name="checkmark-outline"></ion-icon>
                    </button>
                </form>

                <div class="login-footer">
                    <p class="footer-text">
                        ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? 
                        <a href="#" onclick="showLoginForm(event)">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                    </p>
                </div>
            </div>

            <!-- Forgot Password Form -->
            <div class="login-container" id="forgotContainer" style="display: none;">
                <div class="login-header">
                    <div class="login-icon">
                        <ion-icon name="key-outline"></ion-icon>
                    </div>
                    <h2 class="login-title">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h2>
                    <p class="login-subtitle">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</p>
                </div>

                <form class="login-form" id="forgotForm">
                    <div class="form-group">
                        <label for="forgotEmail" class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <div class="input-container">
                            <ion-icon name="mail-outline" class="input-icon"></ion-icon>
                            <input type="email" id="forgotEmail" class="form-input" 
                                placeholder="example@school.ac.th" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="forgotStudentId" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
                        <div class="input-container">
                            <ion-icon name="card-outline" class="input-icon"></ion-icon>
                            <input type="text" id="forgotStudentId" class="form-input" 
                                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏Ñ‡∏£‡∏π" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="forgotPhone" class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <div class="input-container">
                            <ion-icon name="call-outline" class="input-icon"></ion-icon>
                            <input type="tel" id="forgotPhone" class="form-input" 
                                placeholder="0812345678" required>
                        </div>
                    </div>

                    <div class="form-hint" id="forgotHint" style="text-align: center; color: var(--gray); margin-top: 1rem;">
                        üí° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏ß‡πâ
                    </div>

                    <button type="submit" class="login-btn">
                        <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
                        <ion-icon name="send-outline"></ion-icon>
                    </button>
                </form>

                <div class="login-footer">
                    <p class="footer-text">
                        ‡∏à‡∏≥‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß? 
                        <a href="#" onclick="showLoginForm(event)">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner">
                <ion-icon name="reload-outline"></ion-icon>
            </div>
            <h3 id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</h3>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="success-modal" id="successModal">
        <div class="modal-content">
            <div class="success-icon">
                <ion-icon name="checkmark-circle"></ion-icon>
            </div>
            <h3 id="successTitle">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p id="successMessage">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <div class="modal-actions">
                <button class="modal-btn primary" id="successBtn" onclick="closeSuccessModal()">
                    <ion-icon name="checkmark-outline"></ion-icon>
                    ‡∏ï‡∏£‡∏á‡πÑ‡∏õ
                </button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="error-modal" id="errorModal">
        <div class="modal-content">
            <div class="error-icon">
                <ion-icon name="alert-circle"></ion-icon>
            </div>
            <h3>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
            <p id="errorMessage">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
            <div class="modal-actions">
                <button class="modal-btn primary" onclick="closeErrorModal()">
                    <ion-icon name="close-outline"></ion-icon>
                    ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // Wait for Firebase to load
        await new Promise(resolve => {
            const checkFirebase = setInterval(() => {
                if (window.firebaseAuth && window.firebaseDB) {
                    clearInterval(checkFirebase);
                    resolve();
                }
            }, 100);
        });

        const auth = window.firebaseAuth;
        const db = window.firebaseDB;
        const dbRef = window.firebaseRef;
        const dbSet = window.firebaseSet;
        const dbGet = window.firebaseGet;
        const dbUpdate = window.firebaseUpdate;

        // Check for remembered login
        window.addEventListener('DOMContentLoaded', () => {
            const rememberedEmail = localStorage.getItem('rememberedEmail');
            if (rememberedEmail) {
                document.getElementById('loginEmail').value = rememberedEmail;
                document.getElementById('remember').checked = true;
            }

            // Check if user is already logged in
            window.authStateChanged(auth, (user) => {
                if (user && localStorage.getItem('autoLogin') === 'true') {
                    window.location.href = 'index.html';
                }
            });
        });

        // Password validation
        document.getElementById('regPassword')?.addEventListener('input', function() {
            const password = this.value;
            const hint = document.getElementById('passwordHint');
            
            if (password.length === 0) {
                hint.textContent = '';
                hint.className = 'form-hint';
                return;
            }
            
            if (password.length < 6) {
                hint.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£';
                hint.className = 'form-hint error';
            } else {
                hint.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á';
                hint.className = 'form-hint success';
            }
            
            validateConfirmPassword();
        });

        document.getElementById('confirmPassword')?.addEventListener('input', validateConfirmPassword);

        function validateConfirmPassword() {
            const password = document.getElementById('regPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            const hint = document.getElementById('confirmHint');
            
            if (confirm.length === 0) {
                hint.textContent = '';
                hint.className = 'form-hint';
                return;
            }
            
            if (password === confirm) {
                hint.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
                hint.className = 'form-hint success';
            } else {
                hint.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
                hint.className = 'form-hint error';
            }
        }

        // Login Form
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const remember = document.getElementById('remember').checked;
            
            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            
            try {
                const userCredential = await window.signInUser(auth, email, password);
                const user = userCredential.user;
                
                // Get user data from database
                const userRef = dbRef(db, 'users/' + user.uid);
                const snapshot = await dbGet(userRef);
                
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    
                    // Save to localStorage
                    localStorage.setItem('userData', JSON.stringify({
                        uid: user.uid,
                        email: user.email,
                        ...userData,
                        loginTime: new Date().toISOString()
                    }));
                    localStorage.setItem('isLoggedIn', 'true');
                    
                    if (remember) {
                        localStorage.setItem('rememberedEmail', email);
                        localStorage.setItem('autoLogin', 'true');
                    } else {
                        localStorage.removeItem('rememberedEmail');
                        localStorage.removeItem('autoLogin');
                    }
                    
                    hideLoading();
                    showSuccess(
                        '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${userData.firstName} ${userData.lastName}`,
                        () => window.location.href = 'index.html'
                    );
                } else {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
                }
            } catch (error) {
                hideLoading();
                let errorMsg = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                
                if (error.code === 'auth/invalid-email') {
                    errorMsg = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else if (error.code === 'auth/user-not-found') {
                    errorMsg = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ';
                } else if (error.code === 'auth/wrong-password') {
                    errorMsg = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else if (error.code === 'auth/invalid-credential') {
                    errorMsg = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                }
                
                showError(errorMsg);
            }
        });

        // Register Form
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const password = document.getElementById('regPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (password !== confirm) {
                showError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
                return;
            }
            
            if (password.length < 6) {
                showError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                return;
            }
            
            const userData = {
                role: document.getElementById('role').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('regEmail').value,
                phone: document.getElementById('phone').value,
                studentId: document.getElementById('studentId').value,
                classField: document.getElementById('classField').value,
                createdAt: new Date().toISOString(),
                attendanceRate: 0,
                attendedDays: 0,
                absentDays: 0
            };
            
            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
            
            try {
                const userCredential = await window.createUser(auth, userData.email, password);
                const user = userCredential.user;
                
                // Save user data to database
                await dbSet(dbRef(db, 'users/' + user.uid), userData);
                
                hideLoading();
                showSuccess(
                    '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${userData.firstName} ${userData.lastName}`,
                    () => {
                        document.getElementById('loginEmail').value = userData.email;
                        showLoginForm();
                    }
                );
            } catch (error) {
                hideLoading();
                let errorMsg = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMsg = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else if (error.code === 'auth/weak-password') {
                    errorMsg = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏û‡∏≠';
                }
                
                showError(errorMsg);
            }
        });

        // Forgot Password Form - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        document.getElementById('forgotForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('forgotEmail').value;
            const studentId = document.getElementById('forgotStudentId').value;
            const phone = document.getElementById('forgotPhone').value;
            
            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            
            try {
                // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const usersRef = dbRef(db, 'users');
                const snapshot = await dbGet(usersRef);
                
                let userFound = false;
                let userEmail = '';
                
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏ô
                    for (let uid in users) {
                        const user = users[uid];
                        if (user.email === email && 
                            user.studentId === studentId && 
                            user.phone === phone) {
                            userFound = true;
                            userEmail = user.email;
                            break;
                        }
                    }
                }
                
                if (!userFound) {
                    hideLoading();
                    showError('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß ‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                    return;
                }
                
                // ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
                await window.resetPassword(auth, userEmail);
                
                hideLoading();
                showSuccess(
                    '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    '‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á Spam)',
                    () => showLoginForm()
                );
            } catch (error) {
                hideLoading();
                let errorMsg = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•';
                
                if (error.code === 'auth/user-not-found') {
                    errorMsg = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMsg = '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
                }
                
                showError(errorMsg);
            }
        });

        // UI Functions
        window.togglePassword = function(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('ion-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.name = 'eye-off-outline';
            } else {
                input.type = 'password';
                icon.name = 'eye-outline';
            }
        };

        window.showLoginForm = function(e) {
            if (e) e.preventDefault();
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('registerContainer').style.display = 'none';
            document.getElementById('forgotContainer').style.display = 'none';
        };

        window.showRegisterForm = function(e) {
            if (e) e.preventDefault();
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('registerContainer').style.display = 'block';
            document.getElementById('forgotContainer').style.display = 'none';
        };

        window.showForgotForm = function(e) {
            if (e) e.preventDefault();
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('registerContainer').style.display = 'none';
            document.getElementById('forgotContainer').style.display = 'block';
        };

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showSuccess(title, message, callback) {
            document.getElementById('successTitle').textContent = title;
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').classList.add('active');
            
            window.successCallback = callback;
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').classList.add('active');
        }

        window.closeSuccessModal = function() {
            document.getElementById('successModal').classList.remove('active');
            if (window.successCallback) {
                window.successCallback();
                window.successCallback = null;
            }
        };

        window.closeErrorModal = function() {
            document.getElementById('errorModal').classList.remove('active');
        };
    </script>
</body>
</html>
